
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Stateful, Part 2: How Stateful Cheats at Analysis - Chasing Rabbits</title>
  <meta name="author" content="Erick Tryzelaar">

  
  <meta name="description" content="As I mentioned in the last
part,
Stateful has some challenges it needs to overcome in order to add new and
exciting control flow mechanisms to Rust. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://erickt.github.io/blog/2016/01/28/stateful">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Chasing Rabbits" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32180054-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Chasing Rabbits</a></h1>
  
    <h2>A poorly updated blog about what I&#8217;m working on</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:erickt.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Stateful, Part 2: How Stateful Cheats at Analysis</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-01-28T08:22:33-08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>8:22 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>As I mentioned in the last
<a href="https://erickt.github.io/blog/2016/01/27/stateful-in-progress-generators/">part</a>,
<code>Stateful</code> has some challenges it needs to overcome in order to add new and
exciting control flow mechanisms to Rust.  While we don&rsquo;t get access to any of
the cool analysis passes inside the Rust compiler, <code>Stateful</code> is able to sneak
around their necessity in many cases since it really only needs to support a
subset of Rust.  Here are some of the techniques it exploits, err, uses.</p>

<h3>Variables</h3>

<p>First off, let&rsquo;s talk about variables.  One of the primary things <code>Stateful</code>
needs to do is manage the process of state flowing through the machine.  However,
consider a statement like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="kd">let</span> <span class="n">x</span> <span class="o">=</span> <span class="p">...;</span>
</span></code></pre></td></tr></table></div></figure>


<p>&ldquo;Obviously it&rsquo;s a variable, right?&rdquo;  Actually you can&rsquo;t be sure.  What if
someone did:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="k">enum</span> <span class="n">Foo</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">x</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="kn">use</span> <span class="n">Foo</span><span class="o">::*</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Well then the compiler would helpfully report:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="n">foo</span><span class="p">.</span><span class="n">rs</span><span class="o">:</span><span class="mi">7</span><span class="o">:</span><span class="mi">9</span><span class="o">:</span> <span class="mi">7</span><span class="o">:</span><span class="mi">10</span> <span class="n">error</span><span class="o">:</span> <span class="n">declaration</span> <span class="n">of</span> <span class="err">`</span><span class="n">x</span><span class="err">`</span> <span class="n">shadows</span> <span class="n">an</span> <span class="k">enum</span> <span class="n">variant</span> <span class="n">or</span> <span class="n">unit</span><span class="o">-</span><span class="n">like</span> <span class="k">struct</span> <span class="k">in</span> <span class="n">scope</span> <span class="p">[</span><span class="n">E0413</span><span class="p">]</span>
</span><span class='line'><span class="n">foo</span><span class="p">.</span><span class="n">rs</span><span class="o">:</span><span class="mi">7</span>     <span class="kd">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>But that warning only works for simple <code>let</code> statements.  Consider what happens
with matches.  Consider:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="k">match</span> <span class="p">...</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">x</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">y</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Is <code>x</code> or <code>y</code> a variable, or a variant?  There&rsquo;s no way to know unless you
perform name resolution, otherwise known as the resolve pass in the compiler.
Unfortunately though, there&rsquo;s no way for <code>Stateful</code> to run that analysis.  As
Sm√©agol said, &ldquo;There is another way.  More secret, and dark way.&rdquo;.  This leads
us to Cheat Number One: <strong>Stateful assumes that all lowercase identifiers are
variables, and uppercase ones are enum variants.</strong> Sure, Rust supports
lowercase variants, but there&rsquo;s no reason why <code>Stateful</code> has to use them.  It
makes our lives much easier.</p>

<h3>Types</h3>

<p>The next problem is typing.  Sure, Rust is nice and all that you can write a
local variable like <code>let x = ...</code> and it&rsquo;ll infer the type for you.  All Rust
asks for is that the user explicitly specify the type of a value that enters or
leaves the bounds of a function.  Our problem is that one of the main tasks of
<code>Stateful</code> is to lift variables into some <code>State</code> structure so that their
available when the function is re-entered.  So in effect, all variables inside
<code>Stateful</code> must be typed.  Consider the example from last week:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="k">fn</span> <span class="n">advance</span><span class="p">(</span><span class="k">mut</span> <span class="n">state</span><span class="o">:</span> <span class="n">State</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">usize</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">State</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">loop</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">match</span> <span class="n">state</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">Enter</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="kd">let</span> <span class="k">mut</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>                <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Loop</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">Loop</span> <span class="p">{</span> <span class="k">mut</span> <span class="n">i</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Then</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Else</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">Then</span> <span class="p">{</span> <span class="k">mut</span> <span class="n">i</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">return_</span><span class="o">!</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">State</span><span class="o">::</span><span class="n">AfterYield</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">Else</span> <span class="p">{</span> <span class="k">mut</span> <span class="n">i</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">AfterLoop</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">AfterYield</span> <span class="p">{</span> <span class="k">mut</span> <span class="n">i</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>                <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Loop</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">AfterLoop</span> <span class="p">{</span> <span class="k">mut</span> <span class="n">i</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Exit</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">Exit</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">return_</span><span class="o">!</span><span class="p">(</span><span class="nb">None</span><span class="p">;</span> <span class="n">State</span><span class="o">::</span><span class="n">Exit</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This <code>State</code> enumeration is what I&rsquo;m talking about.  It gets passed into and
out of the <code>advance</code> function.  It needs to be some concrete type, which looks
something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="k">enum</span> <span class="n">State</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Enter</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Loop</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">usize</span> <span class="p">},</span>
</span><span class='line'>    <span class="n">Then</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">usize</span> <span class="p">},</span>
</span><span class='line'>    <span class="n">Else</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">usize</span> <span class="p">},</span>
</span><span class='line'>    <span class="n">AfterYield</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">usize</span> <span class="p">},</span>
</span><span class='line'>    <span class="n">AfterLoop</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">usize</span> <span class="p">},</span>
</span><span class='line'>    <span class="n">Exit</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The problem is that we want to write code like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="cp">#[generator]</span>
</span><span class='line'><span class="k">fn</span> <span class="n">gen3</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">usize</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="k">mut</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">yield_</span><span class="o">!</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So how can we resolve this?  Well first, we could wait for
<a href="https://github.com/rust-lang/rfcs/pull/105">RFC 105</a>
or <a href="https://github.com/rust-lang/rfcs/pull/1305">RFC 1305</a> to get implemented,
but that&rsquo;s not happening any time soon.  Until then, there is cheat number two:
<strong>Hide state variables in a boxed trait</strong>.  This one is from Eduard Burtescu.
Instead of the nice well typed example from the last post, we actually generate
some code that hides the types with an over abundance of generic types:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="k">fn</span> <span class="n">gen3</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">usize</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">Wrapper</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">F</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">state</span><span class="o">:</span> <span class="n">S</span><span class="p">,</span>
</span><span class='line'>        <span class="n">next</span><span class="o">:</span> <span class="n">F</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">impl</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">F</span><span class="o">&gt;</span> <span class="nb">Iterator</span> <span class="k">for</span> <span class="n">Wrapper</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">F</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="n">where</span> <span class="n">S</span><span class="o">:</span> <span class="nb">Default</span><span class="p">,</span>
</span><span class='line'>              <span class="n">F</span><span class="o">:</span> <span class="n">Fn</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">type</span> <span class="n">Item</span> <span class="o">=</span> <span class="n">T</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">fn</span> <span class="n">next</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">::</span><span class="n">Item</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>              <span class="kd">let</span> <span class="n">old_state</span> <span class="o">=</span> <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">mem</span><span class="o">::</span><span class="n">replace</span><span class="p">(</span>
</span><span class='line'>                  <span class="o">&amp;</span><span class="k">mut</span> <span class="bp">self</span><span class="p">.</span><span class="n">state</span><span class="p">,</span>
</span><span class='line'>                  <span class="n">S</span><span class="o">::</span><span class="n">default</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>              <span class="kd">let</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">next_state</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">next</span><span class="p">)(</span><span class="n">old_state</span><span class="p">);</span>
</span><span class='line'>              <span class="bp">self</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">next_state</span><span class="p">;</span>
</span><span class='line'>              <span class="n">value</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">enum</span> <span class="n">State</span><span class="o">&lt;</span><span class="n">T0</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Enter</span><span class="p">,</span>
</span><span class='line'>        <span class="n">Loop</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">T0</span> <span class="p">},</span>
</span><span class='line'>        <span class="n">Then</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">T0</span> <span class="p">},</span>
</span><span class='line'>        <span class="n">Else</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">T0</span> <span class="p">},</span>
</span><span class='line'>        <span class="n">AfterYield</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">T0</span> <span class="p">},</span>
</span><span class='line'>        <span class="n">AfterLoop</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">T0</span> <span class="p">},</span>
</span><span class='line'>        <span class="n">Exit</span><span class="p">,</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">impl</span><span class="o">&lt;</span><span class="n">T0</span><span class="o">&gt;</span> <span class="nb">Default</span> <span class="k">for</span> <span class="n">State</span><span class="o">&lt;</span><span class="n">T0</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">fn</span> <span class="n">default</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Self</span> <span class="p">{</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">State</span><span class="o">::</span><span class="n">State1End</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Box</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="n">Wrapper</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Start</span><span class="p">,</span> <span class="o">|</span><span class="k">mut</span> <span class="n">state</span><span class="o">|</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">loop</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">match</span> <span class="n">state</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">State</span><span class="o">::</span><span class="n">Enter</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                    <span class="kd">let</span> <span class="k">mut</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>                    <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Loop</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="n">State</span><span class="o">::</span><span class="n">Loop</span> <span class="p">{</span> <span class="k">mut</span> <span class="n">i</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Then</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Else</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="n">State</span><span class="o">::</span><span class="n">Then</span> <span class="p">{</span> <span class="k">mut</span> <span class="n">i</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">return_</span><span class="o">!</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="n">i</span><span class="p">);</span> <span class="n">State</span><span class="o">::</span><span class="n">AfterYield</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="n">State</span><span class="o">::</span><span class="n">Else</span> <span class="p">{</span> <span class="k">mut</span> <span class="n">i</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">AfterLoop</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="n">State</span><span class="o">::</span><span class="n">AfterYield</span> <span class="p">{</span> <span class="k">mut</span> <span class="n">i</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>                    <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Loop</span> <span class="p">{</span> <span class="n">i</span><span class="o">:</span> <span class="n">i</span> <span class="p">});</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="n">State</span><span class="o">::</span><span class="n">AfterLoop</span> <span class="p">{</span> <span class="k">mut</span> <span class="n">i</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">goto</span><span class="o">!</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">Exit</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>                <span class="n">State</span><span class="o">::</span><span class="n">Exit</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">return_</span><span class="o">!</span><span class="p">(</span><span class="nb">None</span><span class="p">;</span> <span class="n">State</span><span class="o">::</span><span class="n">Exit</span><span class="p">);</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}))</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>All for the cost of a boxed variable.  It&rsquo;s not ideal, but it does let us keep
experimenting.  However, if we do want to avoid this allocation, we can just
require that all variables that survive across a yield point have their type
specified.  So our previous example would be written as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="cp">#[generator]</span>
</span><span class='line'><span class="k">fn</span> <span class="n">gen3</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">usize</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="k">mut</span> <span class="n">i</span><span class="o">:</span> <span class="n">usize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">yield_</span><span class="o">!</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s not so bad here, but it&rsquo;d get obnoxious if we had a generator like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="cp">#[generator]</span>
</span><span class='line'><span class="k">fn</span> <span class="n">complicated</span><span class="p">(</span><span class="n">items</span><span class="o">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">usize</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">usize</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">item</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">iter</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">yield_</span><span class="o">!</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The type of <code>iter</code>, by the way, is impossible to write because there is
currently no way to specify the type of the closure.  Instead, it needs to be
rewritten to use a free function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="cp">#[generator]</span>
</span><span class='line'><span class="k">fn</span> <span class="n">complicated</span><span class="p">(</span><span class="n">items</span><span class="o">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">usize</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=</span><span class="n">usize</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">fn</span> <span class="n">map</span><span class="o">&lt;</span><span class="nl">&#39;a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">item</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">&#39;a</span> <span class="n">usize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">usize</span> <span class="p">{</span> <span class="o">*</span><span class="n">item</span> <span class="o">*</span> <span class="mi">3</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">let</span> <span class="n">iter</span><span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">iter</span><span class="o">::</span><span class="nb">Map</span><span class="o">&lt;</span>
</span><span class='line'>            <span class="n">std</span><span class="o">::</span><span class="n">slice</span><span class="o">::</span><span class="n">Iter</span><span class="o">&lt;</span><span class="nl">&#39;a</span><span class="p">,</span> <span class="n">usize</span><span class="o">&gt;</span><span class="p">,</span>
</span><span class='line'>            <span class="k">fn</span><span class="p">(</span><span class="o">&amp;</span><span class="n">&#39;a</span> <span class="n">usize</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">usize</span>
</span><span class='line'>        <span class="o">&gt;</span>
</span><span class='line'>        <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="n">map</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">iter</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">yield_</span><span class="o">!</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If we want to support closures though, we need to use the <code>Box&lt;Iterator&lt;...&gt;</code>
trick.</p>

<h3>References</h3>

<p>This one&rsquo;s a doozy.  Here&rsquo;s an example of the problem.  Consider:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="cp">#[generator]</span>
</span><span class='line'><span class="k">fn</span> <span class="n">gen</span><span class="o">&lt;</span><span class="nl">&#39;a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">opt</span><span class="o">:</span> <span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="n">&#39;a</span> <span class="k">mut</span> <span class="n">usize</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=&amp;</span><span class="n">&#39;a</span> <span class="k">mut</span> <span class="n">usize</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">match</span> <span class="n">opt</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">Some</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">yield_</span><span class="o">!</span><span class="p">(</span><span class="n">value</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>        <span class="nb">None</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This would look something like this (which also demonstrates how <code>match</code>
statements are represented):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="p">...</span>
</span><span class='line'><span class="n">Box</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="n">Wrapper</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">State0Start</span> <span class="p">{</span> <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span> <span class="p">},</span> <span class="o">|</span><span class="k">mut</span> <span class="n">state</span><span class="o">|</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">loop</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">match</span> <span class="n">state</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State0Start</span> <span class="p">{</span> <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">match</span> <span class="n">opt</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nb">Some</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State2Arm</span> <span class="p">{</span>
</span><span class='line'>                            <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span><span class="p">,</span>
</span><span class='line'>                            <span class="n">value</span><span class="o">:</span> <span class="n">value</span><span class="p">,</span>
</span><span class='line'>                        <span class="p">};</span>
</span><span class='line'>                        <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                    <span class="nb">None</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State3Arm</span> <span class="p">{</span> <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span> <span class="p">};</span>
</span><span class='line'>                        <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State1End</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="p">(</span><span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">option</span><span class="o">::</span><span class="nb">Option</span><span class="o">::</span><span class="nb">None</span><span class="p">,</span> <span class="n">State</span><span class="o">::</span><span class="n">State1End</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State2Arm</span> <span class="p">{</span> <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="o">:</span> <span class="n">value</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="p">(</span><span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">option</span><span class="o">::</span><span class="nb">Option</span><span class="o">::</span><span class="nb">Some</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
</span><span class='line'>                        <span class="n">State</span><span class="o">::</span><span class="n">State5AfterYield</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">value</span><span class="o">:</span> <span class="n">value</span><span class="p">,</span>
</span><span class='line'>                <span class="p">});</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State3Arm</span> <span class="p">{</span> <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                <span class="p">};</span>
</span><span class='line'>                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State4MatchJoin</span> <span class="p">{</span> <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span> <span class="p">};</span>
</span><span class='line'>                <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State4MatchJoin</span> <span class="p">{</span> <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">mem</span><span class="o">::</span><span class="nb">drop</span><span class="p">(</span><span class="n">opt</span><span class="p">);</span>
</span><span class='line'>                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State1End</span><span class="p">;</span>
</span><span class='line'>                <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State5AfterYield</span> <span class="p">{</span>
</span><span class='line'>                              <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="o">:</span> <span class="n">value</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">mem</span><span class="o">::</span><span class="nb">drop</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
</span><span class='line'>                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State4MatchJoin</span> <span class="p">{</span> <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span> <span class="p">};</span>
</span><span class='line'>                <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Zero in on this block:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="p">...</span>
</span><span class='line'><span class="nb">Some</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State2Arm</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span><span class="p">,</span>
</span><span class='line'>        <span class="n">value</span><span class="o">:</span> <span class="n">value</span><span class="p">,</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>    <span class="k">continue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>The type of <code>opt</code> is <code>Option&lt;&amp;'a mut usize&gt;</code>, and <code>value</code> is <code>&amp;'a mut usize</code>.
So we&rsquo;ve got two outstanding mutable borrows, which is illegal.  The real
problem is that <code>Stateful</code> without Resolve and the Borrow Checker pass, it
cannot know if a use of the variable is a copy or move in all cases.  So we now
have cheat number 3: <strong>Use pseudo-macros to hint to Stateful if a type is
copyable or movable</strong>.  This is the same technique we use to implement the
pseudo-macro <code>yield_!(...)</code>, where we would add <code>move_!(...)</code> and <code>copy_!(...)</code>
to inform <code>Stateful</code> when something has been, well, moved or copied.  Our
previous example would then be written as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="cp">#[generator]</span>
</span><span class='line'><span class="k">fn</span> <span class="n">gen</span><span class="o">&lt;</span><span class="nl">&#39;a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">opt</span><span class="o">:</span> <span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="n">&#39;a</span> <span class="k">mut</span> <span class="n">usize</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">=&amp;</span><span class="n">&#39;a</span> <span class="k">mut</span> <span class="n">usize</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">match</span> <span class="n">move_</span><span class="o">!</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">Some</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">yield_</span><span class="o">!</span><span class="p">(</span><span class="n">value</span><span class="p">);</span> <span class="p">}</span>
</span><span class='line'>        <span class="nb">None</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Which would then give <code>Stateful</code> enough information to generate something like
this, which would then know that the match consumed the option:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="n">Box</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="n">Wrapper</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="n">State</span><span class="o">::</span><span class="n">State0Start</span> <span class="p">{</span> <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span> <span class="p">},</span> <span class="o">|</span><span class="k">mut</span> <span class="n">state</span><span class="o">|</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">loop</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">match</span> <span class="n">state</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State0Start</span> <span class="p">{</span> <span class="n">opt</span><span class="o">:</span> <span class="n">opt</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">match</span> <span class="n">opt</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nb">Some</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State2Arm</span> <span class="p">{</span>
</span><span class='line'>                            <span class="n">value</span><span class="o">:</span> <span class="n">value</span><span class="p">,</span>
</span><span class='line'>                        <span class="p">};</span>
</span><span class='line'>                        <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                    <span class="nb">None</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State3Arm</span><span class="p">;</span>
</span><span class='line'>                        <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State1End</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="p">(</span><span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">option</span><span class="o">::</span><span class="nb">Option</span><span class="o">::</span><span class="nb">None</span><span class="p">,</span> <span class="n">State</span><span class="o">::</span><span class="n">State1End</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State2Arm</span> <span class="p">{</span> <span class="n">value</span><span class="o">:</span> <span class="n">value</span> <span class="p">}</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="p">(</span><span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">option</span><span class="o">::</span><span class="nb">Option</span><span class="o">::</span><span class="nb">Some</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
</span><span class='line'>                <span class="n">State</span><span class="o">::</span><span class="n">State5AfterYield</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State3Arm</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State4MatchJoin</span><span class="p">;</span>
</span><span class='line'>                <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State4MatchJoin</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State1End</span><span class="p">;</span>
</span><span class='line'>                <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">State</span><span class="o">::</span><span class="n">State5AfterYield</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">::</span><span class="n">State4MatchJoin</span><span class="p">;</span>
</span><span class='line'>                <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}))</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;m also considering some default rules, that can be overridden with these
macros:</p>

<ul>
<li>If a value is known to be copyable (it&rsquo;s a primitive type, or it&rsquo;s a <code>&amp;T</code>
type), then it&rsquo;s always copied. All other types are assumed to not be
copyable.</li>
<li>Non-copyable types are moved when passed into a function argument, unless
wrapped in a <code>copy_!(...)</code> hint.</li>
<li>Non-copyable type method calls are by reference, unless explicitly wrapped in
a <code>move_!(...)</code> hint.</li>
<li>Non-copyable types are moved in <code>match</code> statement, unless one of the match
arms uses <code>ref</code> or <code>ref mut</code>.</li>
</ul>


<p>Hopefully this will enable a vast majority of code to work without
<code>copy_!(...)</code> or <code>move_!(...)</code>.</p>

<h3>Conclusion</h3>

<p>Those are our major cheats!  I&rsquo;m sure there will be plenty more in the future.
In the meantime, I want to show off some some actual working code!  Check this
puppy out!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">feature</span><span class="p">(</span><span class="n">plugin</span><span class="p">)]</span>
</span><span class='line'><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">plugin</span><span class="p">(</span><span class="n">stateful</span><span class="p">)]</span>
</span><span class='line'>
</span><span class='line'><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">allow</span><span class="p">(</span><span class="n">dead_code</span><span class="p">)]</span>
</span><span class='line'><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">allow</span><span class="p">(</span><span class="n">non_shorthand_field_patterns</span><span class="p">)]</span>
</span><span class='line'><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">allow</span><span class="p">(</span><span class="n">unused_mut</span><span class="p">)]</span>
</span><span class='line'><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">allow</span><span class="p">(</span><span class="n">unused_variables</span><span class="p">)]</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#[generator]</span>
</span><span class='line'><span class="k">fn</span> <span class="n">gen</span><span class="o">&lt;</span><span class="nl">&#39;a</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">items</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">&#39;a</span> <span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="o">&amp;</span><span class="n">&#39;a</span> <span class="n">T</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="k">mut</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">iter</span><span class="p">();</span>
</span><span class='line'>    <span class="k">loop</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">match</span> <span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="nb">Some</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">yield_</span><span class="o">!</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nb">None</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">};</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">fn</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">let</span> <span class="n">items</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">value</span> <span class="k">in</span> <span class="n">gen</span><span class="p">(</span><span class="n">items</span><span class="p">).</span><span class="n">take</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Produces:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="mi">1</span>
</span><span class='line'><span class="mi">2</span>
</span><span class='line'><span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>


<p>Isn&rsquo;t it beautiful?  We got generics, mutable variables, loops, matches,
breaks, <strong>and</strong> a whole host of ignored warnings!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Erick Tryzelaar</span></span>

      




<time class='entry-date' datetime='2016-01-28T08:22:33-08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>8:22 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/async-slash-await/'>async/await</a>, <a class='category' href='/blog/categories/generators/'>generators</a>, <a class='category' href='/blog/categories/rust/'>rust</a>, <a class='category' href='/blog/categories/stateful/'>stateful</a>, <a class='category' href='/blog/categories/syntax-extensions/'>syntax extensions</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://erickt.github.io/blog/2016/01/28/stateful/" data-via="" data-counturl="http://erickt.github.io/blog/2016/01/28/stateful/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/01/27/stateful-in-progress-generators/" title="Previous Post: Stateful: a Rust experimental syntax extension for generators and more">&laquo; Stateful: a Rust experimental syntax extension for generators and more</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/01/28/stateful/">Stateful, Part 2: How Stateful Cheats at Analysis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/27/stateful-in-progress-generators/">Stateful: A Rust Experimental Syntax Extension for Generators and More</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/22/if-you-use-unsafe/">If You Use Unsafe, You Should Be Using Compiletest</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/07/serde-0-dot-5-0-many-many-changes/">Serde 0.5.0 - Many Many Changes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/18/serde-0-dot-4-0-now-supports-macros-in-stable-rust/">Serde 0.4.0 - Syntax Extensions in Stable Rust and More!</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/erickt">@erickt</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'erickt',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Erick Tryzelaar -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
